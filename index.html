<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Darkroom Process Timer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  padding: 10px;
  background: #000;
  color: #0f0;
  font-family: system-ui, monospace;
}
.app {
  max-width: 380px;
  margin: auto;
}
h1 {
  text-align: center;
  font-size: 18px;
}
label {
  font-size: 12px;
}
input, select, textarea, button {
  width: 100%;
  margin-bottom: 6px;
  padding: 6px;
  font-size: 14px;
  border-radius: 4px;
  border: none;
}
textarea {
  resize: vertical;
}
button {
  background: #0f0;
  color: #000;
}
.secondary {
  background: #333;
  color: #0f0;
}
.row {
  display: flex;
  gap: 6px;
}
.step {
  display: flex;
  gap: 6px;
  margin-bottom: 4px;
}
.step input {
  flex: 1;
}
.step button {
  width: 36px;
}
.timer {
  text-align: center;
  font-size: 36px;
  margin: 10px 0;
}
.current {
  text-align: center;
  font-size: 14px;
}
hr {
  border: 0;
  border-top: 1px solid #333;
  margin: 8px 0;
}
</style>
</head>

<body>
<div class="app">
<h1>Darkroom Process Timer</h1>

<label>Process type</label>
<select id="processType">
  <option>Film</option>
  <option>Printing</option>
  <option>Alternative Printing</option>
</select>

<label>Film / Paper</label>
<input id="filmName">

<label>Developer</label>
<input id="developerName">
  <label>Temperature(°C) </label>
  <input id="temperature" placeholder="e.g.20">

<label>Push / Pull</label>
<select id="pushPull">
  <option>Pull -2</option>
  <option>Pull -1</option>
  <option selected>Normal</option>
  <option>Push +1</option>
  <option>Push +2</option>
  <option>Push +3</option>
</select>

<label>Variation / Notes</label>
<textarea id="notes"></textarea>

<hr>

<div id="steps"></div>
<button class="secondary" onclick="addStep()">+ Add Step</button>

<hr>

<div class="current" id="currentStep"></div>
<div class="timer" id="timer">00:00</div>

<div class="row">
  <button onclick="start()">Start</button>
  <button class="secondary" onclick="pause()">Pause</button>
  <button class="secondary" onclick="stopTimer()">Stop</button>
</div>

<hr>

<button onclick="saveProcess()">Save Process</button>
<select id="savedProcesses" onchange="loadProcess()"></select>

<div class="row">
  <button class="secondary" onclick="deleteProcess()">Delete</button>
  <button class="secondary" onclick="exportProcess()">Export</button>
  <button class="secondary" onclick="importProcess()">Import</button>
</div>

<input type="file" id="fileInput" hidden>

</div>

<script>
let steps = [];
let timerIndex = 0;
let remaining = 0;
let interval = null;

let processes = JSON.parse(localStorage.getItem("darkroomProcesses")) || {};

function addStep(name="", min=0, sec=0) {
  steps.push({ name, min, sec });
  renderSteps();
}

function removeStep(i) {
  steps.splice(i,1);
  renderSteps();
}

function renderSteps() {
  const box = document.getElementById("steps");
  box.innerHTML = "";
  steps.forEach((s,i)=>{
    const div = document.createElement("div");
    div.className="step";
    div.innerHTML = `
      <input placeholder="Step" value="${s.name}" onchange="steps[${i}].name=this.value">
      <input type="number" placeholder="Min" value="${s.min}" onchange="steps[${i}].min=Number(this.value)">
      <input type="number" placeholder="Sec" value="${s.sec}" onchange="steps[${i}].sec=Number(this.value)">
      <button onclick="removeStep(${i})">×</button>
    `;
    box.appendChild(div);
  });
}

function start() {
  if (!steps.length) return;
  timerIndex = 0;
  nextStep();
}

function nextStep() {
  if (interval) clearInterval(interval);
  if (timerIndex >= steps.length) {
    document.getElementById("currentStep").innerText = "Done";
    document.getElementById("timer").innerText = "00:00";
    vibrate();
    return;
  }
  const s = steps[timerIndex];
  remaining = s.min*60 + s.sec;
  document.getElementById("currentStep").innerText = s.name;
  tick();
  interval = setInterval(tick,1000);
}

function tick() {
  const m = Math.floor(remaining/60);
  const s = remaining%60;
  document.getElementById("timer").innerText =
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
  if (remaining<=0) {
    vibrate();
    timerIndex++;
    nextStep();
  }
  remaining--;
}

function pause() {
  if (interval) {
    clearInterval(interval);
    interval = null;
  } else {
    interval = setInterval(tick,1000);
  }
}

function stopTimer() {
  if (interval) clearInterval(interval);
  interval=null;
  document.getElementById("timer").innerText="00:00";
  document.getElementById("currentStep").innerText="";
}

function vibrate() {
  navigator.vibrate?.(300);
}

function saveProcess() {
  const name = prompt("Name this process");
  if (!name) return;
  processes[name] = {
    processType: processType.value,
    filmName: filmName.value,
    developerName: developerName.value,
    temperature: temperature.value,
    pushPull: pushPull.value,
    notes: notes.value,
    steps
  };
  localStorage.setItem("darkroomProcesses", JSON.stringify(processes));
  refreshProcessList();
}

function refreshProcessList() {
  const sel = document.getElementById("savedProcesses");
  sel.innerHTML = "<option value=''>Load process</option>";
  Object.keys(processes).forEach(p=>{
    const o=document.createElement("option");
    o.value=o.textContent=p;
    sel.appendChild(o);
  });
}

function loadProcess() {
  const p = processes[savedProcesses.value];
  if (!p) return;
  processType.value = p.processType;
  filmName.value = p.filmName;
  developerName.value = p.developerName;
  temperature.value = p.temperature;
  pushPull.value = p.pushPull;
  notes.value = p.notes;
  steps = p.steps;
  renderSteps();
}
  function deleteProcess() {
  const name = savedProcesses.value;
  if (!name) {
    alert("No process selected");
    return;
  }

  if (!confirm(`Delete "${name}"? This cannot be undone.`)) return;

  delete processes[name];
  localStorage.setItem("darkroomProcesses", JSON.stringify(processes));

  savedProcesses.value = "";
  refreshProcessList();
}

function exportProcess() {
  const data = JSON.stringify(processes,null,2);
  const blob = new Blob([data],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="darkroom-processes.json";
  a.click();
}

function importProcess() {
  fileInput.click();
}

fileInput.onchange = e => {
  const file = e.target.files[0];
  const r = new FileReader();
  r.onload = ()=> {
    processes = JSON.parse(r.result);
    localStorage.setItem("darkroomProcesses", JSON.stringify(processes));
    refreshProcessList();
  };
  r.readAsText(file);
};

addStep("Developer",8,0);
addStep("Stop",0,30);
addStep("Fix",5,0);
addStep("Wash",10,0);
refreshProcessList();
renderSteps();
</script>
</body>
</html>
