<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Darkroom Process Timer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  padding: 10px;
  background: #0a0a0a;
  color: #d0d0d0;
  font-family: system-ui, monospace;
}
.app {
  max-width: 360px;
  margin: auto;
}
h1 {
  text-align: center;
  font-size: 18px;
}
label {
  font-size: 12px;
}
input, select, textarea, button {
  width: 100%;
  margin-bottom: 6px;
  padding: 6px;
  font-size: 14px;
  border-radius: 4px;
  border: 1px solid #444;
  background: #1a1a1a;
  color: #d0d0d0;
}
  .current {
  text-align: center;
  font-size: 16px;
  padding: 6px;
  border: 2px solid #9d84b7;
  border-radius: 6px;
  margin-bottom: 6px;
}
textarea {
  resize: vertical;
  color: #d0d0d0;
  background: #1a1a1a;
}
button {
  min-height: 48px;
  font-size: 16px;
  background: #9d84b7;
  color: #000;
}
button:hover {
  background: #b8a0d0;
}
.secondary {
  background: #444;
  color: #9d84b7;
  border: 1px solid #9d84b7;
}
.row {
  display: flex;
  gap: 6px;
}
.step {
  display: flex;
  gap: 6px;
  margin-bottom: 4px;
}
.step input {
  flex: 1;
}
.step button {
  width: 36px;
}
.timer {
  text-align: center;
  font-size: 40px;
  margin: 12px 0;
  transition: color 0.3s, transform 0.2s;
}

.timer.running {
  color: #9d84b7;
}

.timer.paused {
  color: #d4a574;
}

.timer.done {
  color: #ff6b6b;
  transform: scale(1.1);
}
.current {
  text-align: center;
  font-size: 14px;
}
hr {
  border: 0;
  border-top: 1px solid #444;
  margin: 8px 0;
}
.info-box {
  background: #1a1a1a;
  border: 1px solid #9d84b7;
  padding: 8px;
  border-radius: 4px;
  margin-bottom: 6px;
  font-size: 12px;
  text-align: center;
  color: #d0d0d0;
}
.step-counter {
  font-weight: bold;
  color: #9d84b7;
}
.upcoming {
  background: #1a1a1a;
  border-left: 3px solid #9d84b7;
  padding: 6px;
  margin-bottom: 6px;
  font-size: 11px;
  max-height: 100px;
  overflow-y: auto;
}
.upcoming-item {
  padding: 4px 0;
  color: #999;
}
.upcoming-item.next {
  color: #9d84b7;
  font-weight: bold;
}
.color-dev { border-left: 4px solid #6a7fdb !important; }
.color-stop { border-left: 4px solid #d4a574 !important; }
.color-fix { border-left: 4px solid #9d84b7 !important; }
.color-wash { border-left: 4px solid #7fccdb !important; }
.step-tip {
  font-size: 10px;
  color: #999;
  font-style: italic;
  margin-top: 4px;
}
.history-panel {
  background: #1a1a1a;
  border: 1px solid #9d84b7;
  padding: 8px;
  border-radius: 4px;
  margin-bottom: 6px;
  font-size: 10px;
  max-height: 150px;
  overflow-y: auto;
}
.history-item {
  padding: 4px;
  border-bottom: 1px solid #444;
  color: #999;
}
.history-item:last-child {
  border-bottom: none;
}
@media (max-width: 480px) {
  .timer {
    font-size: 48px;
  }
  button {
    min-height: 56px;
    font-size: 18px;
  }
  .app {
    max-width: 100%;
  }
}
.audio-toggle {
  width: auto;
  padding: 4px 12px;
  font-size: 12px;
}
.template-btn {
  padding: 6px;
  font-size: 12px;
  background: #2a2a2a;
  color: #9d84b7;
  border: 1px solid #9d84b7;
  margin: 2px;
  cursor: pointer;
}
.template-btn:hover {
  background: #9d84b7;
  color: #000;
}
</style>
</head>

<body>
<div class="app">
<h1>Darkroom Process Timer</h1>

<label>Process type</label>
<select id="processType" onchange="updateProcessNames()">
  <option>Film</option>
  <option>Printing</option>
  <option>Alternative Printing</option>
</select>

<label>Process name</label>
<select id="processName"></select>

<label>Film / Paper</label>
<input id="filmName">

<label>Developer</label>
<input id="developerName">
  <label>Temperature(¬∞C) </label>
  <input id="temperature" placeholder="e.g.20">

<label>Push / Pull</label>
<select id="pushPull">
  <option>Pull -2</option>
  <option>Pull -1</option>
  <option selected>Normal</option>
  <option>Push +1</option>
  <option>Push +2</option>
  <option>Push +3</option>
</select>

<label>Variation / Notes</label>
<textarea id="notes"></textarea>

<hr>

<div id="steps"></div>
<button class="secondary" onclick="addStep()">+ Add Step</button>

<hr>

<div class="info-box" id="totalTime"></div>
<div class="upcoming" id="upcomingSteps"></div>
<div class="info-box" id="pauseTime" style="display:none;"></div>

<div class="current" id="currentStep"></div>
<div style="text-align:center;font-size:12px;color:#666;margin-bottom:6px;">
  <span class="step-counter" id="stepCounter"></span>
</div>
<div class="timer" id="timer">00:00</div>
<div id="progress" style="height:14px;background:#333;border-radius:4px;overflow:hidden;border:1px solid #555;">
  <div id="bar" style="height:100%;width:0%;background:#9d84b7;"></div>
</div>

<div class="row">
 <button id="startBtn" onclick="start()">Start</button>
<button id="pauseBtn" class="secondary" onclick="pause()">Pause</button>
<button id="stopBtn" class="secondary" onclick="stopTimer()">Stop</button>
<button class="audio-toggle secondary" id="audioToggle" onclick="toggleAudio()" title="Toggle sound">üîä</button>
</div>

<hr>

<button onclick="saveProcess()">Save Process</button>
<select id="savedProcesses" onchange="loadProcess()"></select>

<div style="margin-bottom: 6px;">
  <button class="secondary" style="margin-bottom: 3px; font-size: 11px;" onclick="toggleTemplates()">‚≠ê Quick Templates</button>
  <div id="templatesBox" style="display:none;background:#1a1a1a;border:1px solid #9d84b7;padding:6px;border-radius:4px;margin-bottom:6px;">
    <button class="template-btn" onclick="loadTemplate('C-41 Film')">C-41 Film</button>
    <button class="template-btn" onclick="loadTemplate('E-6 Film')">E-6 Film</button>
    <button class="template-btn" onclick="loadTemplate('B&W Film')">B&W Film</button>
    <button class="template-btn" onclick="loadTemplate('RA-4 Print')">RA-4 Print</button>
    <button class="template-btn" onclick="loadTemplate('B&W Print')">B&W Print</button>
    <button class="template-btn" onclick="loadTemplate('Cyanotype')">Cyanotype</button>
    <button class="template-btn" onclick="loadTemplate('Platinum/Palladium')">Platinum</button>
  </div>
</div>

<div class="history-panel" id="historyPanel"></div>

<div class="row">
  <button class="secondary" onclick="deleteProcess()">Delete</button>
  <button class="secondary" onclick="exportCSV()">CSV</button>
  <button class="secondary" onclick="exportProcess()">JSON</button>
  <button class="secondary" onclick="importProcess()">Import</button>
  <button class="secondary" onclick="printCard()">Print</button>
</div>

<input type="file" id="fileInput" hidden>

</div>

<script>

const timer = document.getElementById("timer");
const currentStep = document.getElementById("currentStep");
const startBtn = document.getElementById("startBtn");
const pauseBtn = document.getElementById("pauseBtn");
const stopBtn = document.getElementById("stopBtn");
const bar = document.getElementById("bar");
const processType = document.getElementById("processType");
const processName = document.getElementById("processName");
const filmName = document.getElementById("filmName");
const developerName = document.getElementById("developerName");
const temperature = document.getElementById("temperature");
const pushPull = document.getElementById("pushPull");
const notes = document.getElementById("notes");
const savedProcesses = document.getElementById("savedProcesses");
const fileInput = document.getElementById("fileInput");
  
let currentProcessName = null;
let steps = [];
let timerIndex = 0;
let remaining = 0;
let interval = null;
let audioEnabled = true;
let pausedTime = 0;
let pauseStartTime = 0;
let history = JSON.parse(localStorage.getItem("darkroomHistory")) || [];

let processes = JSON.parse(localStorage.getItem("darkroomProcesses")) || {};

  const processOptions = {
  "Film": [
    "C-41",
    "ECN-2",
    "E-6",
    "B&W",
    "B&W Reversal"
  ],
  "Printing": [
    "B&W Contact Printing",
    "RA-4 Contact Printing",
    "B&W Reversal Printing",
    "RA-4 Reversal Printing"
  ],
  "Alternative Printing": [
    "Cyanotype",
    "Salt Printing",
    "Carbon Transfer",
    "Vandyke Brown",
    "Albumen",
    "Gum Bichromate",
    "Platinum/Palladium",
    "Bromoil"
  ]
};

const templates = {
  "C-41 Film": { type: "Film", name: "C-41", steps: [
    {name: "Pre-wash", min: 1, sec: 0, tip: "Warm water"},
    {name: "Developer", min: 3, sec: 15, tip: "Agitate every 30 sec"},
    {name: "Stop", min: 0, sec: 30, tip: "Gentle agitation"},
    {name: "Fix", min: 1, sec: 30, tip: "Agitate every 30 sec"},
    {name: "Wash", min: 5, sec: 0, tip: "Multiple rinses"}
  ]},
  "E-6 Film": { type: "Film", name: "E-6", steps: [
    {name: "Developer", min: 6, sec: 0, tip: "Agitate every 30 sec"},
    {name: "Stop", min: 1, sec: 0, tip: "Gentle"},
    {name: "Wash", min: 2, sec: 0, tip: "Clean water"},
    {name: "Bleach", min: 6, sec: 0, tip: ""},
    {name: "Fix", min: 6, sec: 0, tip: ""}
  ]},
  "B&W Film": { type: "Film", name: "B&W", steps: [
    {name: "Developer", min: 8, sec: 0, tip: "Agitate every 30 sec"},
    {name: "Stop", min: 0, sec: 30, tip: ""},
    {name: "Fix", min: 5, sec: 0, tip: ""},
    {name: "Wash", min: 10, sec: 0, tip: ""}
  ]},
  "RA-4 Print": { type: "Printing", name: "RA-4 Contact Printing", steps: [
    {name: "Developer", min: 2, sec: 0, tip: "20-24¬∞C"},
    {name: "Stop", min: 0, sec: 30, tip: ""},
    {name: "Fix", min: 1, sec: 0, tip: ""},
    {name: "Wash", min: 5, sec: 0, tip: ""}
  ]},
  "B&W Print": { type: "Printing", name: "B&W Contact Printing", steps: [
    {name: "Developer", min: 1, sec: 30, tip: "Rock tray"},
    {name: "Stop", min: 0, sec: 20, tip: ""},
    {name: "Fix", min: 2, sec: 0, tip: ""},
    {name: "Wash", min: 5, sec: 0, tip: ""}
  ]},
  "Cyanotype": { type: "Alternative Printing", name: "Cyanotype", steps: [
    {name: "Coat", min: 0, sec: 1, tip: "Brush evenly"},
    {name: "Dry", min: 10, sec: 0, tip: "In dark room"},
    {name: "Expose", min: 15, sec: 0, tip: "UV light or sun"},
    {name: "Rinse", min: 5, sec: 0, tip: "Wash in water"}
  ]},
  "Platinum/Palladium": { type: "Alternative Printing", name: "Platinum/Palladium", steps: [
    {name: "Coat", min: 0, sec: 1, tip: "Brush evenly"},
    {name: "Dry", min: 10, sec: 0, tip: "Heat"},
    {name: "Expose", min: 10, sec: 0, tip: "UV light"},
    {name: "Develop", min: 2, sec: 0, tip: "Potassium oxalate"}
  ]}
};

  function updateProcessNames(selected = null) {
  const type = processType.value;
  const list = processOptions[type] || [];
  processName.innerHTML = "";

  list.forEach(name => {
    const o = document.createElement("option");
    o.value = o.textContent = name;
    processName.appendChild(o);
  });

  if (selected) {
    processName.value = selected;
  }
}

function addStep(name="", min=0, sec=0, tip="") {
  steps.push({ name, min, sec, tip });
  renderSteps();
}

function removeStep(i) {
  steps.splice(i,1);
  renderSteps();
}

function renderSteps() {
  const box = document.getElementById("steps");
  box.innerHTML = "";

  steps.forEach((s, i) => {
    const div = document.createElement("div");
    div.className = "step";

    const nameInput = document.createElement("input");
    nameInput.placeholder = "Step";
    nameInput.value = s.name;
    nameInput.oninput = e => steps[i].name = e.target.value;

    const minInput = document.createElement("input");
    minInput.type = "number";
    minInput.placeholder = "Min";
    minInput.value = s.min;
    minInput.oninput = e => steps[i].min = Number(e.target.value);

    const secInput = document.createElement("input");
    secInput.type = "number";
    secInput.placeholder = "Sec";
    secInput.value = s.sec;
    secInput.oninput = e => steps[i].sec = Number(e.target.value);

    const btn = document.createElement("button");
    btn.textContent = "√ó";
    btn.onclick = () => removeStep(i);

    div.append(nameInput, minInput, secInput, btn);
    
    const tipInput = document.createElement("input");
    tipInput.placeholder = "Tip (e.g. Agitate every 30 sec)";
    tipInput.value = s.tip || "";
    tipInput.style.fontSize = "11px";
    tipInput.oninput = e => steps[i].tip = e.target.value;
    div.appendChild(tipInput);
    
    box.appendChild(div);
  });
}
  
function start() {
  if (!steps.length) return;
  timer.className = "timer running";
  timerIndex = 0;
  pausedTime = 0;
  updateTotalTime();
  updateUpcomingSteps();
  nextStep();
  startBtn.disabled = true;
  pauseBtn.disabled = false;
  pauseBtn.textContent = "Pause";
  timer.className = "timer running";
}

function updateTotalTime() {
  let totalSec = 0;
  steps.forEach(s => {
    totalSec += s.min * 60 + s.sec;
  });
  const m = Math.floor(totalSec / 60);
  const s = totalSec % 60;
  document.getElementById("totalTime").innerText = 
    `Total: ${m}m ${s}s`;
}

function updateUpcomingSteps() {
  const upcoming = document.getElementById("upcomingSteps");
  upcoming.innerHTML = "";
  if (timerIndex < steps.length) {
    const current = steps[timerIndex];
    const tip = current.tip || "";
    upcoming.innerHTML = `<div class="upcoming-item next">‚ñ∂ ${current.name}${tip ? ": " + tip : ""}</div>`;
    for (let i = timerIndex + 1; i < Math.min(timerIndex + 3, steps.length); i++) {
      const s = steps[i];
      upcoming.innerHTML += `<div class="upcoming-item">${s.name} (${s.min}:${String(s.sec).padStart(2,"0")})</div>`;
    }
  }
}

function getStepColor(name) {
  const lower = name.toLowerCase();
  if (lower.includes("develop")) return "color-dev";
  if (lower.includes("stop")) return "color-stop";
  if (lower.includes("fix")) return "color-fix";
  if (lower.includes("wash")) return "color-wash";
  return "";
}

function nextStep() {
  if (interval) clearInterval(interval);
  if (timerIndex >= steps.length) {
    document.getElementById("currentStep").innerText = "Done";
    currentStep.style.borderColor = "#f00";
    document.getElementById("timer").innerText = "00:00";
    timer.className = "timer done";
    bar.style.width = "100%";
    document.getElementById("stepCounter").innerText = "";
    document.getElementById("upcomingSteps").innerHTML = "";
    addToHistory(currentProcessName || "Quick Process");
    playSound();
    vibrate();
    return;
  }
  const s = steps[timerIndex];
  remaining = s.min*60 + s.sec;
  document.getElementById("currentStep").innerText = s.name;
  currentStep.style.borderColor = "#0f0";
  currentStep.className = getStepColor(s.name);
  document.getElementById("stepCounter").innerText = `Step ${timerIndex + 1} of ${steps.length}`;
  if (s.tip) {
    currentStep.innerHTML += `<div class="step-tip">${s.tip}</div>`;
  }
  bar.style.width = "0%";
  pausedTime = 0;
  tick();
  interval = setInterval(tick,1000);
  updateUpcomingSteps();
}

function tick() {
  const m = Math.floor(remaining/60);
  const s = remaining%60;
  document.getElementById("timer").innerText =
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
  
  const step = steps[timerIndex];
  const totalSeconds = step.min * 60 + step.sec;
  const elapsed = totalSeconds - remaining;
  const progress = (elapsed / totalSeconds) * 100;
  bar.style.width = Math.max(0, progress) + "%";
  
  if (remaining<=0) {
    playSound();
    vibrate();
    timerIndex++;
    nextStep();
  }
  if (remaining <= 10 && remaining > 0) {
    timer.style.transform = "scale(1.15)";
  } else {
    timer.style.transform = "scale(1)";
  }
  remaining--;
}

function pause() {
  if (interval) {
    clearInterval(interval);
    interval = null;
    timer.className = "timer paused";
    pauseBtn.textContent = "Resume";
    pauseStartTime = Date.now();
    document.getElementById("pauseTime").style.display = "block";
  } else {
    if (pauseStartTime) {
      pausedTime += Math.floor((Date.now() - pauseStartTime) / 1000);
    }
    document.getElementById("pauseTime").style.display = "none";
    interval = setInterval(tick, 1000);
    timer.className = "timer running";
    pauseBtn.textContent = "Pause";
  }
}

let pauseInterval = null;

function updatePauseTime() {
  if (pauseStartTime) {
    const elapsed = pausedTime + Math.floor((Date.now() - pauseStartTime) / 1000);
    const m = Math.floor(elapsed / 60);
    const s = elapsed % 60;
    document.getElementById("pauseTime").innerText = 
      `Paused: ${m}m ${s}s`;
  }
}

function stopTimer() {
  if (interval) clearInterval(interval);
  if (pauseInterval) clearInterval(pauseInterval);
  interval=null;
  pauseInterval = null;
  document.getElementById("timer").innerText="00:00";
  document.getElementById("currentStep").innerText="";
  document.getElementById("stepCounter").innerText="";
  document.getElementById("upcomingSteps").innerHTML="";
  document.getElementById("pauseTime").style.display="none";
  startBtn.disabled = false;
  pauseBtn.textContent = "Pause";
  timer.className = "timer";
  pausedTime = 0;
}

function vibrate() {
  navigator.vibrate?.(300);
}

function playSound() {
  if (!audioEnabled) return;
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  oscillator.frequency.value = 800;
  oscillator.type = 'sine';
  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.5);
}

function toggleAudio() {
  audioEnabled = !audioEnabled;
  document.getElementById("audioToggle").style.opacity = audioEnabled ? "1" : "0.5";
  if (audioEnabled) playSound();
}

function saveProcess() {
  let name = currentProcessName;

  if (!name) {
    name = prompt("Name this process");
    if (!name) return;
  }

  processes[name] = {
    processType: processType.value,
    processName: processName.value,
    filmName: filmName.value,
    developerName: developerName.value,
    temperature: temperature.value,
    pushPull: pushPull.value,
    notes: notes.value,
    steps: JSON.parse(JSON.stringify(steps))
  };

  localStorage.setItem("darkroomProcesses", JSON.stringify(processes));
  currentProcessName = name;
  refreshProcessList();
  addToHistory(name);
}
  
function refreshProcessList() {
  const sel = document.getElementById("savedProcesses");
  sel.innerHTML = "<option value=''>Load process</option>";
  Object.keys(processes).forEach(p=>{
    const o=document.createElement("option");
    o.value=o.textContent=p;
    sel.appendChild(o);
  });
}

function loadProcess() {
  currentProcessName = savedProcesses.value;
  const p = processes[savedProcesses.value];
  if (!p) return;
  processType.value = p.processType;
  updateProcessNames(p.processName);
  filmName.value = p.filmName;
  developerName.value = p.developerName;
  temperature.value = p.temperature;
  pushPull.value = p.pushPull;
  notes.value = p.notes;
  steps = JSON.parse(JSON.stringify(p.steps));
  renderSteps();
  updateTotalTime();
}

function deleteProcess() {
  const name = savedProcesses.value;
  if (!name) {
    alert("No process selected");
    return;
  }

  if (!confirm(`Delete "${name}"? This cannot be undone.`)) return;

  delete processes[name];
  localStorage.setItem("darkroomProcesses", JSON.stringify(processes));

  savedProcesses.value = "";
  currentProcessName = null;
  refreshProcessList();
}

function exportProcess() {
  const data = JSON.stringify(processes,null,2);
  const blob = new Blob([data],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="darkroom-processes.json";
  a.click();
}

function importProcess() {
  fileInput.click();
}

fileInput.onchange = e => {
  const file = e.target.files[0];
  const r = new FileReader();
  r.onload = ()=> {
    processes = JSON.parse(r.result);
    localStorage.setItem("darkroomProcesses", JSON.stringify(processes));
    refreshProcessList();
  };
  r.readAsText(file);
};

function exportCSV() {
  const rows = [];
  rows.push([
    "Process Name",
    "Process Type",
    "Film / Paper",
    "Developer",
    "Temperature",
    "Push / Pull",
    "Notes",
    "Steps",
    "Total Time (min)"
  ]);

  Object.entries(processes).forEach(([name, p]) => {
    let totalSeconds = 0;
    const stepText = p.steps.map(s => {
      const secs = (s.min * 60) + s.sec;
      totalSeconds += secs;
      const tip = s.tip ? ` [${s.tip}]` : "";
      return `${s.name} ${s.min}:${String(s.sec).padStart(2,"0")}${tip}`;
    }).join(" | ");

    rows.push([
      name,
      p.processType || "",
      p.filmName || "",
      p.developerName || "",
      p.temperature || "",
      p.pushPull || "",
      (p.notes || "").replace(/\n/g," "),
      stepText,
      Math.round(totalSeconds / 60)
    ]);
  });

  const csv = rows.map(r =>
    r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(",")
  ).join("\n");

  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "darkroom-log.csv";
  a.click();
}

function addToHistory(processName) {
  const now = new Date();
  const timeStr = now.toLocaleTimeString().slice(0, 5);
  const dateStr = now.toLocaleDateString();
  history.unshift(`${dateStr} ${timeStr} - ${processName}`);
  if (history.length > 20) history.pop();
  localStorage.setItem("darkroomHistory", JSON.stringify(history));
  updateHistory();
}

function updateHistory() {
  const panel = document.getElementById("historyPanel");
  if (history.length === 0) {
    panel.innerHTML = "<div style='color:#666;text-align:center;'>No history yet</div>";
    return;
  }
  panel.innerHTML = "<strong style='color:#0f0;'>Recent:</strong>";
  history.slice(0, 10).forEach(entry => {
    const item = document.createElement("div");
    item.className = "history-item";
    item.textContent = entry;
    panel.appendChild(item);
  });
}

function toggleTemplates() {
  const box = document.getElementById("templatesBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function loadTemplate(name) {
  const template = templates[name];
  if (!template) return;
  
  processType.value = template.type;
  updateProcessNames(template.name);
  steps = JSON.parse(JSON.stringify(template.steps));
  renderSteps();
  updateTotalTime();
  toggleTemplates();
}

function printCard() {
  if (steps.length === 0) {
    alert("No steps to print");
    return;
  }
  
  let content = `
    <html>
    <head>
      <title>Darkroom Card</title>
      <style>
        body { font-family: monospace; margin: 20px; line-height: 1.8; }
        h1 { margin: 10px 0; }
        .info { margin: 10px 0; border: 1px solid #000; padding: 10px; }
        .step { margin: 8px 0; padding: 5px; border-left: 3px solid #000; padding-left: 10px; }
        .tip { font-size: 0.9em; color: #666; }
      </style>
    </head>
    <body>
      <h1>${processName.value || currentProcessName || "Process"}</h1>
      <div class="info">
        <strong>Process:</strong> ${processName.value}<br>
        <strong>Film/Paper:</strong> ${filmName.value}<br>
        <strong>Developer:</strong> ${developerName.value}<br>
        <strong>Temperature:</strong> ${temperature.value}¬∞C<br>
        <strong>Push/Pull:</strong> ${pushPull.value}
      </div>
      <h3>Steps:</h3>
  `;
  
  steps.forEach((s, i) => {
    content += `
      <div class="step">
        ${i + 1}. <strong>${s.name}</strong> - ${s.min}:${String(s.sec).padStart(2,"0")}
        ${s.tip ? `<div class="tip">${s.tip}</div>` : ""}
      </div>
    `;
  });
  
  content += `</body></html>`;
  
  const win = window.open();
  win.document.write(content);
  win.document.close();
  setTimeout(() => win.print(), 250);
}

addStep("Developer",8,0,"Agitate every 30 sec");
addStep("Stop",0,30,"");
addStep("Fix",5,0,"");
addStep("Wash",10,0,"Multiple rinses");
refreshProcessList();
updateProcessNames();
renderSteps();
updateTotalTime();
updateHistory();
pauseInterval = setInterval(updatePauseTime, 100);

document.addEventListener("keydown", (e) => {
  if (e.code === "Space") {
    e.preventDefault();
    if (!startBtn.disabled) start();
    else if (!pauseBtn.disabled) pause();
  }
  if (e.code === "Escape") stopTimer();
});

</script>
</body>
</html>
