<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Darkroom Process Timer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  padding: 12px;
  background: #000;
  color: #0f0;
  font-family: system-ui, monospace;
}

.app {
  max-width: 360px;
  margin: auto;
}

h1 {
  text-align: center;
  font-size: 18px;
  margin-bottom: 10px;
}

.step {
  display: flex;
  gap: 6px;
  margin-bottom: 6px;
}

input {
  padding: 6px;
  font-size: 14px;
  border: none;
  border-radius: 4px;
}

.step-name {
  flex: 1.5;
}

.step-time {
  width: 80px;
  text-align: center;
}

button {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin-top: 8px;
  border-radius: 6px;
  border: none;
  background: #0f0;
  color: #000;
}

.small-btn {
  background: #333;
  color: #0f0;
  margin-top: 4px;
}

.timer {
  text-align: center;
  font-size: 36px;
  margin: 12px 0;
}

.current-step {
  text-align: center;
  font-size: 16px;
}
</style>
</head>

<body>

<div class="app">
  <h1>Darkroom Process Timer</h1>

  <div id="steps"></div>

  <button class="small-btn" onclick="addStep()">+ Add step</button>

  <div class="current-step" id="currentStep"></div>
  <div class="timer" id="timer">00:00</div>

  <button onclick="start()">Start</button>
</div>

<script>
let steps = JSON.parse(localStorage.getItem("darkroomSteps")) || [
  { name: "Developer", time: 480 },
  { name: "Stop", time: 30 },
  { name: "Fix", time: 300 },
  { name: "Wash", time: 600 }
];

let index = 0;
let remaining = 0;
let interval = null;

function save() {
  localStorage.setItem("darkroomSteps", JSON.stringify(steps));
}

function render() {
  const box = document.getElementById("steps");
  box.innerHTML = "";
  steps.forEach((s, i) => {
    const div = document.createElement("div");
    div.className = "step";
    div.innerHTML = `
      <input class="step-name" value="${s.name}" onchange="steps[${i}].name=this.value;save()">
      <input class="step-time" type="number" value="${s.time}" onchange="steps[${i}].time=Number(this.value);save()">
    `;
    box.appendChild(div);
  });
}

function start() {
  if (!steps.length) return;
  index = 0;
  nextStep();
}

function nextStep() {
  if (interval) clearInterval(interval);
  if (index >= steps.length) {
    document.getElementById("currentStep").innerText = "Done";
    document.getElementById("timer").innerText = "00:00";
    beep();
    return;
  }
  remaining = steps[index].time;
  document.getElementById("currentStep").innerText = steps[index].name;
  tick();
  interval = setInterval(tick, 1000);
}

function tick() {
  const m = Math.floor(remaining / 60);
  const s = remaining % 60;
  document.getElementById("timer").innerText =
    `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  if (remaining <= 0) {
    beep();
    index++;
    nextStep();
  }
  remaining--;
}

function beep() {
  navigator.vibrate?.(300);
}

function addStep() {
  steps.push({ name: "Step", time: 60 });
  save();
  render();
}

render();
</script>

</body>
</html>
